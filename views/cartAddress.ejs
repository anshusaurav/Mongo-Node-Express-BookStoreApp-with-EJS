<%- include('partials/header') -%>
<div class='address-container'>
    <h2 class='address-header'>Your Addresses</h2>
    <div class='address-main-grid'>
        <a href='/addresses/onthego' class='address-main-grid-elem add-address-button'>
            <div>
                <div>
                    <div class='address-add-sign'>
                        <i class="fas fa-plus"></i>
                    </div>
                    <p>Add address</p>
                </div>
            </div>
        </a>
    </div>
    <form action='/users/checkout' method='POST'>
    <div class='saved-address-grid'>
    <% addresses.forEach((address, index) => { %> 
        <label class='address-main-grid-elem'>
            <input type='radio' name='addressOption' value='<%=index %>' 
                <% if(user && user.hasDefaultAddress && user.defaultAddress == address.id){%> 
                    checked
                <%}%>
            required/>
            <div >
                <% if(user && user.hasDefaultAddress && user.defaultAddress == address.id){%> 
                <div class='is-default-address'><p>Default</p></div>
                <%}else{%>
                    <div class='not-default-address'></div>
                <%}%>
                <div class='address-general-elem'>
                    <ul class='address-elem-grid'>
                        <li class='address-elem-name'>
                            <%=address.name %>
                        </li>
                        <li>
                            <%=address.street %>
                        </li>
                        <li>
                            <%=address.city %>
                        </li>
                        <li>
                            <%=address.zip %>
                        </li>
                        <li>
                            <%=address.state %>
                        </li>
                        <li>
                            <%=address.number %>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </label>
        <%})%>
        </div>
        <button type='submit' class='cart-address' value=''>Select Address and Proceed</button>
    </form>
        
    <script>
        // var createCheckoutSession = function () {
        //     // var inputEl = document.getElementById('quantity-input');
        //     var quantity = 1;

        //     return fetch('/create-checkout-session', {
        //         method: 'POST',
        //         headers: {
        //         'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify({
        //         locale: i18next.language.toLowerCase().split('-')[0],
        //         }),
        //     }).then(function (result) {
        //         return result.json();
        //     });
        // };

        // /* Get your Stripe publishable key to initialize Stripe.js */
        // fetch('/config')
        // .then(function (result) {
        //     return result.json();
        // })
        // .then(function (json) {
        //     window.config = json;
        //     var stripe = Stripe(config.publicKey);
        //     updateQuantity();
        //     // Setup event handler to create a Checkout Session on submit
        //     document.querySelector('.cart-address').addEventListener('click', function (evt) {
                
        //     createCheckoutSession().then(function (data) {
        //         stripe
        //         .redirectToCheckout({
        //             sessionId: data.sessionId,
        //         })
        //         .then(handleResult);
        //     });
        //     }, true);
        // });
    </script>
</div>  
<%- include('partials/footer') -%>